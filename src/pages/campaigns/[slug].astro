---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { campaigns } from '../../campaigns';

export async function getStaticPaths() {
  return campaigns.map((c) => ({
    params: { slug: c.id },
    props: { campaign: c },
  }));
}

const { campaign } = Astro.props;
const isAcroterra = campaign.id === 'acroterra';

// PDF lives in /public (adjust per-campaign if needed)
const pdfSrc = '/acroterra.pdf';
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={campaign.title} description={campaign.blurb} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root{ --bg:#0b0f1a; --ink:#fff; --edge:rgba(255,255,255,.15); }
      html,body{height:100%}
      body{
        margin:0; color:var(--ink);
        font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
        background:#0b0f1a url('/Mountains.png') center/cover fixed no-repeat;
      }
      main{ width:min(1200px,94%); margin:24px auto; }

      .hero{ margin-bottom:12px; }
      .hero img{ width:100%; max-height:300px; object-fit:cover; border-radius:16px; display:block; }
      .title{
        margin:12px 0 6px;
        font-size:clamp(24px,3.6vw,40px);
        color:#ffffff; /* always white */
      }
      .sub{ opacity:.9; margin:0 0 12px }

      .toolbar{
        display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:flex-start;
        margin:12px 0 16px;
      }
      .btn{
        appearance:none; border:1px solid var(--edge);
        background: rgba(255,255,255,.08); color:#fff; padding:8px 12px;
        border-radius:10px; text-decoration:none; font-size:14px;
        transition: background .2s, border-color .2s, transform .15s;
      }
      .btn:hover{ border-color:#fff; background: rgba(255,255,255,.15); transform: translateY(-1px); }

      /* Standout Virtual Table Top button */
      .vtt-btn{
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:14px 28px;
        font-size:1.1rem;
        font-weight:600;
        color:#fff;
        background:#5b2b82; /* dark purple */
        border:none;
        border-radius:12px;
        text-decoration:none;
        box-shadow:0 6px 16px rgba(0,0,0,0.35);
        transition: background-color .2s ease, transform .15s ease, box-shadow .2s ease;
      }
      .vtt-btn:hover{
        background:#7d42aa;
        transform:translateY(-2px);
        box-shadow:0 10px 22px rgba(0,0,0,0.45);
      }
      .vtt-btn svg{ flex-shrink:0; }

      .pdf-wrap{
        height: 200vh; /* very tall viewer */
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,.4);
        border: 1px solid var(--edge);
        background: rgba(0,0,0,.4);
      }
      .pdf{ width:100%; height:100%; border:0; }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section class="hero">
        <img src={campaign.image} alt={`${campaign.title} banner`} />
        <h1 class="title">{campaign.title}</h1>
        <p class="sub">{campaign.schedule}</p>

        <div class="toolbar">
          {isAcroterra && (
            <>
              <a class="btn" href={pdfSrc} target="_blank" rel="noopener">Open in new tab</a>
              <a class="btn" href={pdfSrc} download>Download PDF</a>
            </>
          )}
          <!-- Button now routes to /vtt so your function can check status -->
          <a class="vtt-btn" href="/vtt">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ffd166" viewBox="0 0 24 24">
              <path d="M12 2 2 9l10 13 10-13-10-7Zm0 2.3L19.1 9H4.9L12 4.3Zm0 15.9-7.16-9.3h14.32L12 20.2Z"/>
            </svg>
            Go to Virtual Table Top
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ffd166" viewBox="0 0 24 24">
              <path d="M12 2 2 9l10 13 10-13-10-7Zm0 2.3L19.1 9H4.9L12 4.3Zm0 15.9-7.16-9.3h14.32L12 20.2Z"/>
            </svg>
          </a>
        </div>
      </section>

      {isAcroterra ? (
        <div class="pdf-wrap">
          <iframe
            class="pdf"
            src={`${pdfSrc}#view=FitH&page=1&toolbar=1&navpanes=1`}
            title="Acroterra Guide PDF"
          ></iframe>
        </div>
      ) : (
        <section>
          <p>{campaign.blurb}</p>
        </section>
      )}
    </main>
    <Footer />
  </body>
</html>
